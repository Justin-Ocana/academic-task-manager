<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Móvil - Notificaciones</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        h1 {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
        }

        .status {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .status-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .status-item:last-child {
            border-bottom: none;
        }

        .status-value {
            font-weight: bold;
        }

        .status-value.ok {
            color: #4caf50;
        }

        .status-value.error {
            color: #f44336;
        }

        button {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }

        .btn-primary {
            background: #2196f3;
        }

        .btn-success {
            background: #4caf50;
        }

        .btn-warning {
            background: #ff9800;
        }

        .log {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Test de Notificaciones Móvil</h1>

        <div class="status">
            <div class="status-item">
                <span>Navegador:</span>
                <span class="status-value" id="browser">-</span>
            </div>
            <div class="status-item">
                <span>Soporte Notificaciones:</span>
                <span class="status-value" id="support">-</span>
            </div>
            <div class="status-item">
                <span>Permiso:</span>
                <span class="status-value" id="permission">-</span>
            </div>
            <div class="status-item">
                <span>HTTPS:</span>
                <span class="status-value" id="https">-</span>
            </div>
        </div>

        <button class="btn-primary" onclick="requestPermission()">
            Solicitar Permiso
        </button>

        <button class="btn-success" onclick="testNotification()">
            Probar Notificación
        </button>

        <button class="btn-warning" onclick="testVibration()">
            Probar Vibración
        </button>

        <div class="log" id="log"></div>
    </div>

    <script>
        function log(message) {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            const time = new Date().toLocaleTimeString();
            entry.textContent = `[${time}] ${message}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
        }

        function updateStatus() {
            // Navegador
            const ua = navigator.userAgent;
            let browser = 'Desconocido';
            if (ua.includes('Chrome')) browser = 'Chrome';
            else if (ua.includes('Firefox')) browser = 'Firefox';
            else if (ua.includes('Safari')) browser = 'Safari';
            document.getElementById('browser').textContent = browser;

            // Soporte
            const support = 'Notification' in window;
            const supportEl = document.getElementById('support');
            supportEl.textContent = support ? 'Sí' : 'No';
            supportEl.className = 'status-value ' + (support ? 'ok' : 'error');

            // Permiso
            const permission = Notification.permission;
            const permEl = document.getElementById('permission');
            permEl.textContent = permission;
            permEl.className = 'status-value ' + (permission === 'granted' ? 'ok' : 'error');

            // HTTPS
            const isHttps = location.protocol === 'https:';
            const httpsEl = document.getElementById('https');
            httpsEl.textContent = isHttps ? 'Sí' : 'No';
            httpsEl.className = 'status-value ' + (isHttps ? 'ok' : 'error');

            log('Estado actualizado');
        }

        async function requestPermission() {
            log('Solicitando permiso...');
            try {
                const permission = await Notification.requestPermission();
                log('Permiso: ' + permission);
                updateStatus();
            } catch (error) {
                log('ERROR: ' + error.message);
            }
        }

        function testNotification() {
            log('Probando notificación...');

            if (Notification.permission !== 'granted') {
                log('ERROR: No hay permiso');
                showConfirm({
                    title: 'Permiso requerido',
                    message: 'Primero debes dar permiso para enviar notificaciones',
                    confirmText: 'Entendido',
                    cancelText: '',
                    type: 'warning'
                });
                return;
            }

            try {
                const notification = new Notification('Agenda Virtual Eiwa', {
                    body: 'Esta es una notificación de prueba desde tu móvil',
                    icon: window.location.origin + '/static/img/logoeiwa.png',
                    vibrate: [200, 100, 200],
                    tag: 'test-' + Date.now()
                });

                notification.onshow = () => log('Notificación mostrada');
                notification.onerror = (e) => log('ERROR: ' + e);
                notification.onclick = () => {
                    log('Notificación clickeada');
                    notification.close();
                };

                log('Notificación creada');
            } catch (error) {
                log('ERROR: ' + error.message);
            }
        }

        function testVibration() {
            log('Probando vibración...');
            if ('vibrate' in navigator) {
                navigator.vibrate([200, 100, 200]);
                log('Vibración ejecutada');
            } else {
                log('Vibración no soportada');
            }
        }

        // Inicializar
        updateStatus();
        log('Página cargada');
    </script>
</body>

</html>