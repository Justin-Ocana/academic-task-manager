{% extends 'Dashboard/base_dashboard.html' %}
{% load static %}

{% block title %}Personalizar Avatar - Agenda Virtual Eiwa{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/avatar-settings.css' %}">
{% endblock %}

{% block content %}
<div class="form-container">
    <div class="page-header">
        <h1>Personalizar Avatar</h1>
        <p>Elige tu estilo y colores favoritos</p>
    </div>

    <form method="post" class="avatar-form" id="avatarForm">
        {% csrf_token %}

        <!-- Preview Section -->
        <div class="avatar-preview-section">
            <h2 class="section-title">Vista Previa</h2>
            <div class="avatar-preview-container">
                <div class="avatar-preview-large" id="avatarPreview">
                    <!-- SVG will be injected here -->
                </div>
                <div class="avatar-info">
                    <h3>{{ user.nombre }} {{ user.apellido }}</h3>
                    <p>{{ user.email }}</p>
                </div>
            </div>
        </div>

        <!-- Avatar Selection -->
        <div class="form-group avatar-group">
            <label class="form-label">Preselección Agenda Virtual Eiwa:</label>
            <div class="avatar-selector">
                <!-- Avatar 1: Smile -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="smile" checked>
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <circle cx="35" cy="40" r="5" fill="currentColor"/>
                            <circle cx="65" cy="40" r="5" fill="currentColor"/>
                            <path d="M30 60 Q50 75 70 60" stroke="currentColor" stroke-width="5" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 2: Cat -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="cat">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M20 30 L30 15 L35 30 Z" fill="currentColor"/>
                            <path d="M80 30 L70 15 L65 30 Z" fill="currentColor"/>
                            <circle cx="35" cy="45" r="4" fill="currentColor"/>
                            <circle cx="65" cy="45" r="4" fill="currentColor"/>
                            <path d="M40 60 L50 65 L60 60" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
                            <path d="M50 65 L50 55" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 3: Star Eyes -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="star-eyes">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M35 40 L37 46 L43 46 L38 50 L40 56 L35 52 L30 56 L32 50 L27 46 L33 46 Z" fill="currentColor"/>
                            <path d="M65 40 L67 46 L73 46 L68 50 L70 56 L65 52 L60 56 L62 50 L57 46 L63 46 Z" fill="currentColor"/>
                            <circle cx="50" cy="65" r="8" fill="currentColor"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 4: Robot -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="robot">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <rect x="30" y="25" width="40" height="45" rx="5" fill="currentColor"/>
                            <rect x="35" y="35" width="10" height="10" rx="2" fill="white"/>
                            <rect x="55" y="35" width="10" height="10" rx="2" fill="white"/>
                            <rect x="40" y="55" width="20" height="5" rx="2" fill="white"/>
                            <circle cx="50" cy="20" r="3" fill="currentColor"/>
                            <line x1="50" y1="17" x2="50" y2="25" stroke="currentColor" stroke-width="2"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 5: Heart Eyes -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="heart">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M35 40 C35 35 30 32 27 35 C24 32 19 35 19 40 C19 45 27 50 27 50 C27 50 35 45 35 40 Z" fill="currentColor"/>
                            <path d="M81 40 C81 35 76 32 73 35 C70 32 65 35 65 40 C65 45 73 50 73 50 C73 50 81 45 81 40 Z" fill="currentColor"/>
                            <path d="M35 65 Q50 75 65 65" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 6: Glasses -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="glasses">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <circle cx="35" cy="42" r="12" stroke="currentColor" stroke-width="3" fill="none"/>
                            <circle cx="65" cy="42" r="12" stroke="currentColor" stroke-width="3" fill="none"/>
                            <line x1="47" y1="42" x2="53" y2="42" stroke="currentColor" stroke-width="3"/>
                            <path d="M35 60 Q50 68 65 60" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 7: Music -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="music">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <circle cx="35" cy="42" r="4" fill="currentColor"/>
                            <circle cx="65" cy="42" r="4" fill="currentColor"/>
                            <path d="M40 30 L45 25 L50 30 L55 25 L60 30" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
                            <path d="M35 60 Q50 72 65 60" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 8: Wink -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="wink">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <line x1="28" y1="40" x2="42" y2="40" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
                            <circle cx="65" cy="40" r="5" fill="currentColor"/>
                            <path d="M32 62 Q50 75 68 62" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 9: Cool -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="cool">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <rect x="20" y="35" width="60" height="15" rx="7" fill="currentColor"/>
                            <line x1="20" y1="42" x2="15" y2="42" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                            <line x1="80" y1="42" x2="85" y2="42" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                            <path d="M38 65 L62 65" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 10: Bear -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="bear">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <circle cx="25" cy="25" r="10" fill="currentColor"/>
                            <circle cx="75" cy="25" r="10" fill="currentColor"/>
                            <circle cx="35" cy="45" r="4" fill="currentColor"/>
                            <circle cx="65" cy="45" r="4" fill="currentColor"/>
                            <ellipse cx="50" cy="58" rx="8" ry="10" fill="currentColor"/>
                            <path d="M42 65 Q50 70 58 65" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 11: Lightning -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="lightning">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M30 35 L38 25 L35 40 L42 40 L34 55 L37 40 L30 40 Z" fill="currentColor"/>
                            <path d="M68 35 L60 25 L63 40 L56 40 L64 55 L61 40 L68 40 Z" fill="currentColor"/>
                            <path d="M35 65 Q50 75 65 65" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 12: Flower -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="flower">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <circle cx="35" cy="42" r="4" fill="currentColor"/>
                            <circle cx="65" cy="42" r="4" fill="currentColor"/>
                            <circle cx="30" cy="25" r="6" fill="currentColor"/>
                            <circle cx="40" cy="20" r="6" fill="currentColor"/>
                            <circle cx="50" cy="18" r="6" fill="currentColor"/>
                            <circle cx="60" cy="20" r="6" fill="currentColor"/>
                            <circle cx="70" cy="25" r="6" fill="currentColor"/>
                            <path d="M35 60 Q50 70 65 60" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 13: Alien -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="alien">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <ellipse cx="35" cy="42" rx="8" ry="12" fill="currentColor"/>
                            <ellipse cx="65" cy="42" rx="8" ry="12" fill="currentColor"/>
                            <ellipse cx="50" cy="65" rx="15" ry="8" fill="currentColor"/>
                            <circle cx="40" cy="20" r="5" fill="currentColor"/>
                            <circle cx="60" cy="20" r="5" fill="currentColor"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 14: Crown -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="crown">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M25 25 L35 35 L50 20 L65 35 L75 25 L70 45 L30 45 Z" fill="currentColor"/>
                            <circle cx="35" cy="45" r="4" fill="currentColor"/>
                            <circle cx="65" cy="45" r="4" fill="currentColor"/>
                            <path d="M38 62 Q50 70 62 62" stroke="currentColor" stroke-width="4" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 15: Ninja -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="ninja">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <rect x="20" y="30" width="60" height="25" rx="3" fill="currentColor"/>
                            <rect x="28" y="38" width="12" height="8" rx="1" fill="white"/>
                            <rect x="60" y="38" width="12" height="8" rx="1" fill="white"/>
                        </svg>
                    </span>
                </label>

                <!-- Avatar 16: Party -->
                <label class="avatar-option">
                    <input type="radio" name="avatar_style" value="party">
                    <span class="avatar-shape">
                        <svg viewBox="0 0 100 100" fill="none">
                            <path d="M35 20 L40 35 L45 20 L50 35 L55 20 L60 35 L65 20" stroke="currentColor" stroke-width="3" stroke-linecap="round" fill="none"/>
                            <circle cx="32" cy="45" r="5" fill="currentColor"/>
                            <circle cx="68" cy="45" r="5" fill="currentColor"/>
                            <path d="M30 62 Q50 78 70 62" stroke="currentColor" stroke-width="5" stroke-linecap="round" fill="none"/>
                        </svg>
                    </span>
                </label>
            </div>
        </div>

        <!-- Background Color Section -->
        <div class="form-group color-section">
            <button type="button" class="color-section-toggle" id="bgColorToggle">
                <div class="toggle-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    </svg>
                    <span>Color de Fondo</span>
                </div>
                <div class="toggle-preview" id="bgColorPreview" style="background: #FF0000;"></div>
                <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            
            <div class="color-group collapsed" id="bgColorGroup">
                <div class="color-selector" id="bgColorSelector">
                    <!-- Colors will be generated by JavaScript -->
                </div>

                <!-- Custom Color Picker for Background -->
                <div class="custom-color-picker" id="bgCustomColorPicker">
                    <label class="form-label">Color Personalizado:</label>
                    
                    <div class="visual-color-picker">
                        <input type="color" id="bgVisualColorPicker" value="#FF0000">
                        <label for="bgVisualColorPicker" class="color-picker-button">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                            </svg>
                            Seleccionar Color
                        </label>
                    </div>

                    <div class="rgb-inputs">
                        <div class="rgb-input-group">
                            <label>R</label>
                            <input type="number" id="bgColorR" min="0" max="255" value="255">
                        </div>
                        <div class="rgb-input-group">
                            <label>G</label>
                            <input type="number" id="bgColorG" min="0" max="255" value="0">
                        </div>
                        <div class="rgb-input-group">
                            <label>B</label>
                            <input type="number" id="bgColorB" min="0" max="255" value="0">
                        </div>
                    </div>

                    <div class="hex-display">
                        <label>HEX:</label>
                        <input type="text" id="bgHexValue" value="#FF0000" maxlength="7" pattern="^#[0-9A-Fa-f]{6}$">
                    </div>
                </div>
            </div>
        </div>

        <!-- SVG Color Section -->
        <div class="form-group color-section">
            <button type="button" class="color-section-toggle" id="svgColorToggle">
                <div class="toggle-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                    </svg>
                    <span>Color del Diseño</span>
                </div>
                <div class="toggle-preview" id="svgColorPreview" style="background: #FFFFFF; border: 2px solid #e0e0e0;"></div>
                <svg class="toggle-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            
            <div class="color-group collapsed" id="svgColorGroup">
                <div class="color-selector" id="svgColorSelector">
                    <!-- Colors will be generated by JavaScript -->
                </div>

                <!-- Custom Color Picker for SVG -->
                <div class="custom-color-picker" id="svgCustomColorPicker">
                    <label class="form-label">Color Personalizado:</label>
                    
                    <div class="visual-color-picker">
                        <input type="color" id="svgVisualColorPicker" value="#FFFFFF">
                        <label for="svgVisualColorPicker" class="color-picker-button">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
                            </svg>
                            Seleccionar Color
                        </label>
                    </div>

                    <div class="rgb-inputs">
                        <div class="rgb-input-group">
                            <label>R</label>
                            <input type="number" id="svgColorR" min="0" max="255" value="255">
                        </div>
                        <div class="rgb-input-group">
                            <label>G</label>
                            <input type="number" id="svgColorG" min="0" max="255" value="255">
                        </div>
                        <div class="rgb-input-group">
                            <label>B</label>
                            <input type="number" id="svgColorB" min="0" max="255" value="255">
                        </div>
                    </div>

                    <div class="hex-display">
                        <label>HEX:</label>
                        <input type="text" id="svgHexValue" value="#FFFFFF" maxlength="7" pattern="^#[0-9A-Fa-f]{6}$">
                    </div>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <a href="{% url 'profile_settings' %}" class="btn btn-secondary">Cancelar</a>
            <button type="submit" class="btn btn-primary">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                    <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Guardar Avatar
            </button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Pasar valores del servidor al JavaScript
    window.AVATAR_CONFIG = {
        style: '{{ user.avatar_style|default:"smile" }}',
        bgColor: '{{ user.avatar_bg_color|default:"#FF0000" }}',
        svgColor: '{{ user.avatar_svg_color|default:"#FFFFFF" }}'
    };
</script>
<script src="{% static 'js/avatar-settings.js' %}"></script>
{% endblock %}
